# Flyway 마이그레이션 버전 관리 컨벤션

## Flyway 사용 목적

[테코톡 FLYWAY 적용기](https://www.youtube.com/watch?v=pxDlj5jA9z4&t=617s)

- Flyway는 자동화된 데이터베이스 마이그레이션, 일관된 버전 관리, 협업 환경에서의 유연한 데이터베이스 변경을 지원하는 도구입니다. 이를 통해 개발 팀은 데이터베이스 변경
  사항을 쉽게 관리하고, 애플리케이션이 올바르게 동작할 수 있도록 데이터베이스 상태를 유지할 수 있습니다.

## 버전 규칙

> 절대적인 규칙이 아니며, 해당 버전 규칙은 작성자 임의로 규정되었음을 알려드립니다.
- 파일명 `V` 다음에 붙는 숫자가 버전을 의미합니다.
- 즉, `V2.1__init.sql` 파일은 2.1 버전을 의미합니다.
- 버전은 크게 메인 버전과 마이너버전로 관리되며, V{메인버전}.{마이너버전}__{설명}.sql 로 이뤄집니다.
- `V2.1__init.sql`은 즉, V2 버전의 데이터베이스의 첫번째 마이너 버전이라고 볼 수 있습니다.
- 추가적인 버전을 신규로 등록 할 때는, 숫자가 더 높게 설정해야 합니다.
    - 만약, 최종 버전이 `V3.1__update.sql` 이고, 이전 버젼이 `V2.5__modify_name.sql` 일때
    - `V2.6__new_index.sql`을 추가하여도, 적용되지 않습니다.
    - 즉, V3 버전의 마이너 버전을 업데이트 해야 합니다.

### 메인버전

- 메인 버전은 말 그대로, 주요 버전과 관련된 내용입니다.
- 주로, `새로운 테이블 생성`, `컬럼 삭제`, `컬럼 이전`이 발생 하였을 때, 적용됩니다.

### 마이너버전

- 마이너 버전은, 기존 테이블에 대한 추가적인 변경이나, 기능 추가, 속성 변경, 인덱스 추가/변경 등이 이뤄졌을때 사용 됩니다.

### R 파일

- R 파일은 Repeatable Migration 파일로, 반복가능한 마이그레이션 파일을 나타냅니다.
- 파일명 규칙은, `R__` 접두사를 사용하며, 버전은 없습니다.
- 실행될 파일간 우선순위는, 알파벳 숫자 순서를 따릅니다.
    - `R__A_insert_user.sql` 이 `R__B_insert_phone.sql` 보다 반드시 먼저 실행
- 한번 실행되고 난 후, 수정이 있을 경우에만 자동으로 다시 실행 됩니다.